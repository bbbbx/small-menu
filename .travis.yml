language: node_js
node_js:
  - "9"
addons:
  apt:
    sources:
      - mysql-5.7-trusty
    packages:
      - mysql-server
      - mysql-client
services:
  - mysql
before_install:
  - sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('root') where User='root'; update user set plugin='mysql_native_password'; GRANT ALL PRIVILEGES ON *.* TO root@localhost IDENTIFIED BY  'root'; FLUSH PRIVILEGES; SELECT host, user, authentication_string FROM user;"
  - sudo service mysql restart
  - mysql -e 'CREATE DATABASE myapp_test;'
  - mysql -e 'CREATE DATABASE IF NOT EXISTS test;'
  - mysql -e "CREATE DATABASE IF NOT EXISTS smallmenu DEFAULT CHARSET utf8mb4 COLLATE utf8mb4_general_ci;"
install:
  - npm install
script:
  - npm start